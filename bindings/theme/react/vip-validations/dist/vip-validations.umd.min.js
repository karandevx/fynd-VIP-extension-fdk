!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("React"),require("ReactRouterDOM"),require("helmetModule"),require("sharedUtilsLibrary")):"function"==typeof define&&define.amd?define("extension",["React","ReactRouterDOM","helmetModule","sharedUtilsLibrary"],n):"object"==typeof exports?exports.extension=n(require("React"),require("ReactRouterDOM"),require("helmetModule"),require("sharedUtilsLibrary")):e.extension=n(e.React,e.ReactRouterDOM,e.helmetModule,e.sharedUtilsLibrary)}("undefined"!=typeof self?self:this,((e,n,t,o)=>(()=>{"use strict";var a={173:e=>{e.exports=o},333:e=>{e.exports=t},854:e=>{e.exports=n},883:n=>{n.exports=e}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var t=r[e]={exports:{}};return a[e](t,t.exports,i),t.exports}i.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return i.d(n,{a:n}),n},i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};i.r(s),i.d(s,{default:()=>y});var c={};i.r(c),i.d(c,{Component:()=>_,settings:()=>g});var l=i(883),d=i.n(l),u=i(173);i(333);var p=i(854);const m="mutation UpdateCart($areaCode: String, $b: Boolean, $buyNow: Boolean, $i: Boolean, $updateCartId: String, $updateCartRequestInput: UpdateCartRequestInput, $cartType: String) {\n  updateCart(areaCode: $areaCode, b: $b, buyNow: $buyNow, i: $i, id: $updateCartId, updateCartRequestInput: $updateCartRequestInput, cartType: $cartType) {\n      message\n      success\n      cart {\n        buy_now\n        cart_id\n        checkout_mode\n        comment\n        coupon_text\n        delivery_charge_info\n        gstin\n        id\n        is_valid\n        last_modified\n        message\n        pan_config\n        pan_no\n        restrict_checkout\n        uid\n        breakup_values {\n          coupon {\n            code\n            coupon_type\n            coupon_value\n            description\n            is_applied\n            message\n            minimum_cart_value\n            sub_title\n            title\n            type\n            uid\n            value\n          }\n          display {\n            currency_code\n            currency_symbol\n            display\n            key\n            message\n            value\n            preset\n          }\n          loyalty_points {\n            applicable\n            description\n            is_applied\n            total\n          }\n        }\n        delivery_promise {\n          formatted {\n            max\n            min\n          }\n          timestamp {\n            max\n            min\n          }\n        }\n        coupon {\n          cashback_amount\n          cashback_message_primary\n          cashback_message_secondary\n          coupon_code\n          coupon_description\n          coupon_id\n          coupon_subtitle\n          coupon_title\n          coupon_type\n          coupon_value\n          discount\n          is_applied\n          is_valid\n          message\n          minimum_cart_value\n        }\n        applied_promo_details {\n          amount\n          article_quantity\n          code\n          meta\n          mrp_promotion\n          offer_text\n          promo_id\n          promotion_group\n          promotion_name\n          promotion_type\n          applied_free_articles {\n            article_id\n            parent_item_identifier\n            quantity\n          }\n        }\n        currency {\n          code\n          symbol\n        }\n        items {\n          bulk_offer\n          coupon_message\n          custom_order\n          discount\n          is_set\n          key\n          message\n          moq\n          parent_item_identifiers\n          product_ean_id\n          quantity\n          article {\n            _custom_json\n            cart_item_meta\n            extra_meta\n            gift_card\n            identifier\n            is_gift_visible\n            meta\n            mto_quantity\n            parent_item_identifiers\n            product_group_tags\n            quantity\n            seller_identifier\n            size\n            tags\n            type\n            uid\n            seller {\n              name\n              uid\n            }\n            price {\n              base {\n                currency_code\n                currency_symbol\n                effective\n                marked\n              }\n              converted {\n                currency_code\n                currency_symbol\n                effective\n                marked\n              }\n            }\n          }\n          coupon {\n            code\n            discount_single_quantity\n            discount_total_quantity\n          }\n          charges {\n            meta\n            name\n            allow_refund\n            code\n            type\n            amount {\n              currency\n              value\n            }\n          }\n          identifiers {\n            identifier\n          }\n          delivery_promise {\n            formatted {\n              max\n              min\n            }\n            timestamp {\n              max\n              min\n            }\n            iso {\n              max\n              min\n            }\n          }\n          availability {\n            deliverable\n            is_valid\n            other_store_quantity\n            out_of_stock\n            sizes\n            available_sizes {\n              display\n              is_available\n              value\n            }\n          }\n          price {\n            base {\n              currency_code\n              currency_symbol\n              effective\n              marked\n            }\n            converted {\n              currency_code\n              currency_symbol\n              effective\n              marked\n            }\n          }\n          price_per_unit {\n            base {\n              currency_code\n              currency_symbol\n              effective\n              marked\n              selling_price\n            }\n          }\n          product {\n            _custom_json\n            attributes\n            item_code\n            name\n            slug\n            tags\n            type\n            uid\n            action {\n              type\n              url\n              query {\n                product_slug\n              }\n            }\n            brand {\n              name\n              uid\n            }\n            categories {\n              name\n              uid\n            }\n            images {\n              aspect_ratio\n              secure_url\n              url\n            }\n          }\n          promo_meta {\n            message\n          }\n        }\n      }\n  }\n}";function _({props:e}){console.log(": drafting 4");const n=(0,u.useFPI)(),t=(0,p.useNavigate)(),[o,a]=(0,l.useState)(null),[r,i]=(0,l.useState)(null),[s,c]=(0,l.useState)(!0),[_,g]=(0,l.useState)(null),[y,f]=(0,l.useState)(!1),v=(0,u.useGlobalStore)(n.getters.PAGE),b=(0,u.useGlobalStore)(n.getters.CART),h=(0,u.useGlobalStore)(n.getters.PRODUCT),w="10253";console.log("pageDetails",v),console.log("using fpi in vip validations",n),console.log("CART_ITEMS",b),console.log("PRODUCT hellooo",h);const C=(0,u.useGlobalStore)(n?.getters?.PRODUCTS);console.log("productsListData>>>",C);return(0,l.useEffect)((()=>{(async()=>{try{c(!0),g(null),console.log("Fetching campaign data...");const e=await(async()=>{try{const e=await fetch(`https://fetch-db-data-d9ca324b.serverless.boltic.app?companyId=${w}&module=campaigns`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to fetch campaign data");return await e.json()}catch(e){throw console.error("Error fetching campaign data:",e),e}})();if(e.success&&e.data.length>0){const o=e.data.filter((e=>(e=>{const n=new Date,t=new Date(e.startDate),o=new Date(e.endDate);return n>=t&&n<=o})(e)));if(o.length>0){console.log("Active campaigns found:",o);const e=o[0];a(e),console.log("Validating VIP user...");const r=await(async()=>{try{const e=await fetch(`https://fetch-db-data-d9ca324b.serverless.boltic.app?module=users&companyId=${w}&queryType=validate&id=683817d98fbf32007a149c91&applicationId=6838178d9fdd289461be895e`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to validate VIP user");return await e.json()}catch(e){throw console.error("Error validating VIP user:",e),e}})();let s=!1;r.success&&r.data&&r.data.length>0?(console.log("VIP user validation successful:",r.data),i(r.data[0]),s=!0):(console.log("VIP user validation failed - user is not VIP"),i(null),s=!1),console.log("Performing cart and product validations..."),((e,t)=>{if(!b?.cart_items?.items||!e?.products)return;const o=b.cart_items.items;console.log("activeCampaign",e);const a=new Set([{item_code:"marv5rue_KD"}].map((e=>e.item_code?.toLowerCase())));console.log("Campaign product codes:",a),console.log("Is VIP user:",t),o.forEach(((e,o)=>{const r=e?.product?.item_code?.toLowerCase();console.log("Checking cart item:",{name:e?.product?.name,item_code:r,inCampaign:a.has(r)}),r&&a.has(r)&&!t&&(console.log("Removing VIP-only item from cart:",e?.product?.name),(async(e,t,o)=>{try{f(!0);const a={b:!0,i:!0,updateCartRequestInput:{items:[{article_id:`${e?.product?.uid}_${t}`,item_id:e?.product?.uid,item_size:t,item_index:o,quantity:0,identifiers:{identifier:e?.identifiers?.identifier}}],operation:"remove_item"}},r=await n.executeGQL(m,a,{skipStoreUpdate:!0});return f(!1),r?.data?.updateCart?.success?(alert("VIP exclusive item removed from cart","info"),console.log("Item removed successfully:",e?.product?.name),window.location.reload()):alert(r?.data?.updateCart?.message||"Failed to remove item","error"),r?.data?.updateCart}catch(e){console.error("Error removing cart item:",e),alert("An error occurred while removing the item","error"),f(!1)}})(e,e?.article?.size||e?.size,o))}))})(e,s),((e,n)=>{const o=window.location.pathname;if(!o.includes("/product/")||!h||!e?.products)return;const a=h,r=a?.item_code?.toLowerCase();console.log("Product page validation:",{path:o,product_item_code:r,is_vip:n}),r&&new Set(e.products.map((e=>e.item_code?.toLowerCase()))).has(r)&&!n&&(console.log("Non-VIP user trying to access VIP product, redirecting..."),alert("This product is exclusive to VIP members only","error"),setTimeout((()=>{window.history.length>1?t(-1):t("/")}),2e3))})(e,s)}else console.log("No active campaigns found"),a(null)}else console.log("No campaigns found"),a(null)}catch(e){console.error("Error in VIP validation process:",e),g(e.message)}finally{c(!1)}})()}),[b,h,v]),y?d().createElement("div",{className:"vip-validation-updating"},d().createElement("p",null,"Updating cart...")):d().createElement(d().Fragment,null)}const g={label:"VIP validations",name:"vip-validations",props:[],blocks:[]},y={"vip-validations":{...c}};return s})()));
